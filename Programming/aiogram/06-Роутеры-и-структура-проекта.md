# üó∫Ô∏è –†–æ—É—Ç–µ—Ä—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –≤ aiogram 3.x

## üìë –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–í–≤–µ–¥–µ–Ω–∏–µ](#–≤–≤–µ–¥–µ–Ω–∏–µ)
2. [–ß—Ç–æ —Ç–∞–∫–æ–µ —Ä–æ—É—Ç–µ—Ä—ã?](#—á—Ç–æ%20—Ç–∞–∫–æ–µ%20—Ä–æ—É—Ç–µ—Ä—ã)
   - [–ê–Ω–∞–ª–æ–≥–∏—è –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–π –∂–∏–∑–Ω–∏](#–∞–Ω–∞–ª–æ–≥–∏—è%20–∏–∑%20—Ä–µ–∞–ª—å–Ω–æ–π%20–∂–∏–∑–Ω–∏)
   - [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ](#—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ%20–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ)
   - [–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–æ—É—Ç–µ—Ä–æ–≤](#–ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞%20—Ä–æ—É—Ç–µ—Ä–æ–≤)
3. [–ó–∞—á–µ–º –Ω—É–∂–Ω—ã —Ä–æ—É—Ç–µ—Ä—ã?](#–∑–∞—á–µ–º%20–Ω—É–∂–Ω—ã%20—Ä–æ—É—Ç–µ—Ä—ã)
   - [–ü—Ä–æ–±–ª–µ–º—ã –±–µ–∑ —Ä–æ—É—Ç–µ—Ä–æ–≤](#–ø—Ä–æ–±–ª–µ–º—ã%20–±–µ–∑%20—Ä–æ—É—Ç–µ—Ä–æ–≤)
   - [–†–µ—à–µ–Ω–∏–µ —Å —Ä–æ—É—Ç–µ—Ä–∞–º–∏](#—Ä–µ—à–µ–Ω–∏–µ%20—Å%20—Ä–æ—É—Ç–µ—Ä–∞–º–∏)
   - [–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å](#–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å)
4. [–°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–æ–≤](#—Å–æ–∑–¥–∞–Ω–∏–µ%20—Ä–æ—É—Ç–µ—Ä–æ–≤)
   - [–ë–∞–∑–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä](#–±–∞–∑–æ–≤—ã–π%20—Ä–æ—É—Ç–µ—Ä)
   - [–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤](#—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è%20—Ö–µ–Ω–¥–ª–µ—Ä–æ–≤)
   - [–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –¥–∏—Å–ø–µ—Ç—á–µ—Ä—É](#–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ%20–∫%20–¥–∏—Å–ø–µ—Ç—á–µ—Ä—É)
   - [–§–∏–ª—å—Ç—Ä—ã –≤ —Ä–æ—É—Ç–µ—Ä–∞—Ö](#—Ñ–∏–ª—å—Ç—Ä—ã%20–≤%20—Ä–æ—É—Ç–µ—Ä–∞—Ö)
5. [–í–ª–æ–∂–µ–Ω–Ω—ã–µ —Ä–æ—É—Ç–µ—Ä—ã](#–≤–ª–æ–∂–µ–Ω–Ω—ã–µ%20—Ä–æ—É—Ç–µ—Ä—ã)
   - [–ò–µ—Ä–∞—Ä—Ö–∏—è —Ä–æ—É—Ç–µ—Ä–æ–≤](#–∏–µ—Ä–∞—Ä—Ö–∏—è%20—Ä–æ—É—Ç–µ—Ä–æ–≤)
   - [–ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ middleware](#–Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ%20middleware)
   - [–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä](#–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π%20–ø—Ä–∏–º–µ—Ä)
6. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞%20–ø—Ä–æ–µ–∫—Ç–∞)
   - [–ü–æ—á–µ–º—É –≤–∞–∂–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞?](#–ø–æ—á–µ–º—É%20–≤–∞–∂–Ω–∞%20—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
   - [–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞](#—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è%20—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
   - [–û–ø–∏—Å–∞–Ω–∏–µ –ø–∞–ø–æ–∫ –∏ —Ñ–∞–π–ª–æ–≤](#–æ–ø–∏—Å–∞–Ω–∏–µ%20–ø–∞–ø–æ–∫%20–∏%20—Ñ–∞–π–ª–æ–≤)
   - [–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã](#–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ%20—Å—Ç—Ä—É–∫—Ç—É—Ä—ã)
7. [–ü—Ä–∏–º–µ—Ä—ã —Å—Ç—Ä—É–∫—Ç—É—Ä](#–ø—Ä–∏–º–µ—Ä—ã%20—Å—Ç—Ä—É–∫—Ç—É—Ä)
   - [–ü—Ä–æ—Å—Ç–æ–π –±–æ—Ç](#–ø—Ä–æ—Å—Ç–æ–π%20–±–æ—Ç)
   - [–°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ–µ–∫—Ç](#—Å—Ä–µ–¥–Ω–∏–π%20–ø—Ä–æ–µ–∫—Ç)
   - [–ö—Ä—É–ø–Ω—ã–π –ø—Ä–æ–µ–∫—Ç](#–∫—Ä—É–ø–Ω—ã–π%20–ø—Ä–æ–µ–∫—Ç)
   - [–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è%20–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
8. [–õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏](#–ª—É—á—à–∏–µ%20–ø—Ä–∞–∫—Ç–∏–∫–∏)
   - [–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∫–æ–¥–∞](#–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è%20–∫–æ–¥–∞)
   - [–ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–æ–≤](#–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ%20—Ä–æ—É—Ç–µ—Ä–æ–≤)
   - [–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏](#—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ%20–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏)
   - [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
9. [–ó–∞–∫–ª—é—á–µ–Ω–∏–µ](#–∑–∞–∫–ª—é—á–µ–Ω–∏–µ)

---

## üìñ –í–≤–µ–¥–µ–Ω–∏–µ

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –æ–¥–Ω—É –∏–∑ —Å–∞–º—ã—Ö –≤–∞–∂–Ω—ã—Ö –≥–ª–∞–≤ –Ω–∞—à–µ–≥–æ —É—á–µ–±–Ω–∏–∫–∞! –†–æ—É—Ç–µ—Ä—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ ‚Äî —ç—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º —Å—Ç—Ä–æ—è—Ç—Å—è –≤—Å–µ —Å–ª–æ–∂–Ω—ã–µ –±–æ—Ç—ã –Ω–∞ aiogram 3.x. –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –±–æ—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ª–µ–≥–∫–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å, —Ä–∞—Å—à–∏—Ä—è—Ç—å –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å, —Ç–æ —ç—Ç–∞ –≥–ª–∞–≤–∞ –¥–ª—è –≤–∞—Å.

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ?**
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å**: –ß–µ—Ç–∫–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∫–æ–¥–∞ –¥–µ–ª–∞–µ—Ç –µ–≥–æ –ø–æ–Ω—è—Ç–Ω—ã–º –¥–ª—è –≤–∞—Å –∏ –¥—Ä—É–≥–∏—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –†–æ—É—Ç–µ—Ä—ã –ø–æ–∑–≤–æ–ª—è—é—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∫–æ–¥ –≤ —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö
- **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**: –•–æ—Ä–æ—à–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —É–ø—Ä–æ—â–∞–µ—Ç –Ω–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

**–ß—Ç–æ –º—ã –∏–∑—É—á–∏–º:**
- –ß—Ç–æ —Ç–∞–∫–æ–µ —Ä–æ—É—Ç–µ—Ä—ã –∏ –∫–∞–∫ –æ–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤—ã–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞
- –ö–∞–∫ —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Ä–æ—É—Ç–µ—Ä—ã
- –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏
- –ü—Ä–∏–º–µ—Ä—ã —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ –ø—Ä–æ–µ–∫—Ç–æ–≤

–≠—Ç–∞ –≥–ª–∞–≤–∞ –Ω–∞–ø–∏—Å–∞–Ω–∞ –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö, –Ω–æ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏ –¥–ª—è –æ–ø—ã—Ç–Ω—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤. –ú—ã –±—É–¥–µ–º –¥–≤–∏–≥–∞—Ç—å—Å—è –æ—Ç –ø—Ä–æ—Å—Ç—ã—Ö –∫–æ–Ω—Ü–µ–ø—Ü–∏–π –∫ —Å–ª–æ–∂–Ω—ã–º, —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –ø—Ä–∏–º–µ—Ä–æ–≤ –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö —Å–æ–≤–µ—Ç–æ–≤.

---

## ü§î –ß—Ç–æ —Ç–∞–∫–æ–µ —Ä–æ—É—Ç–µ—Ä—ã?

### –ê–Ω–∞–ª–æ–≥–∏—è –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–π –∂–∏–∑–Ω–∏

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ —Å–µ–±–µ –±–æ–ª—å—à–æ–π —Ç–æ—Ä–≥–æ–≤—ã–π —Ü–µ–Ω—Ç—Ä:
- **–¢–æ—Ä–≥–æ–≤—ã–π —Ü–µ–Ω—Ç—Ä** ‚Äî —ç—Ç–æ –≤–∞—à –±–æ—Ç
- **–ú–∞–≥–∞–∑–∏–Ω—ã** ‚Äî —ç—Ç–æ —Ä–æ—É—Ç–µ—Ä—ã
- **–ü—Ä–æ–¥–∞–≤—Ü—ã** ‚Äî —ç—Ç–æ —Ö–µ–Ω–¥–ª–µ—Ä—ã
- **–ü–æ–∫—É–ø–∞—Ç–µ–ª–∏** ‚Äî —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–ö–æ–≥–¥–∞ –ø–æ–∫—É–ø–∞—Ç–µ–ª—å –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ —Ç–æ—Ä–≥–æ–≤—ã–π —Ü–µ–Ω—Ç—Ä, –µ–º—É –Ω—É–∂–Ω–æ –ø–æ–ø–∞—Å—Ç—å –≤ –Ω—É–∂–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω:
1. –û–Ω —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ —É–∫–∞–∑–∞—Ç–µ–ª–∏ (—Ñ–∏–ª—å—Ç—Ä—ã)
2. –ò–¥–µ—Ç –≤ –Ω—É–∂–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω (—Ä–æ—É—Ç–µ—Ä)
3. –û–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –ø—Ä–æ–¥–∞–≤—Ü—É (—Ö–µ–Ω–¥–ª–µ—Ä)

–ë–µ–∑ —Ä–æ—É—Ç–µ—Ä–æ–≤ –≤—Å–µ –ø—Ä–æ–¥–∞–≤—Ü—ã —Ä–∞–±–æ—Ç–∞–ª–∏ –±—ã –≤ –æ–¥–Ω–æ–º –±–æ–ª—å—à–æ–º –∑–∞–ª–µ ‚Äî –±—ã–ª –±—ã —Ö–∞–æ—Å! –†–æ—É—Ç–µ—Ä—ã —Å–æ–∑–¥–∞—é—Ç –ø–æ—Ä—è–¥–æ–∫ –∏ –ª–æ–≥–∏–∫—É –≤ –≤–∞—à–µ–º –±–æ—Ç–µ.

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**–†–æ—É—Ç–µ—Ä (Router)** –≤ aiogram ‚Äî —ç—Ç–æ –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç —Ö–µ–Ω–¥–ª–µ—Ä—ã –ø–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º—É –ø—Ä–∏–∑–Ω–∞–∫—É –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º. –†–æ—É—Ç–µ—Ä –ø–æ—Ö–æ–∂ –Ω–∞ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∫ –Ω—É–∂–Ω—ã–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º.

**–ö–ª—é—á–µ–≤—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Ä–æ—É—Ç–µ—Ä–∞:**
- **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞**: –û–±—ä–µ–¥–∏–Ω—è–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ö–µ–Ω–¥–ª–µ—Ä—ã
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä—ã –∫–æ –≤—Å–µ–º —Å–≤–æ–∏–º —Ö–µ–Ω–¥–ª–µ—Ä–∞–º
- **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å**: –ú–æ–∂–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –¥—Ä—É–≥–∏—Ö —Ä–æ—É—Ç–µ—Ä–æ–≤
- **–í–∫–ª–∞–¥—ã–≤–∞–µ–º–æ—Å—Ç—å**: –†–æ—É—Ç–µ—Ä—ã –º–æ–∂–Ω–æ –≤–∫–ª–∞–¥—ã–≤–∞—Ç—å –¥—Ä—É–≥ –≤ –¥—Ä—É–≥–∞

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–æ—É—Ç–µ—Ä–æ–≤

1. **–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∫–æ–¥–∞**: –õ–æ–≥–∏—á–µ—Å–∫–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ö–µ–Ω–¥–ª–µ—Ä—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤–º–µ—Å—Ç–µ
2. **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –†–æ—É—Ç–µ—Ä—ã –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö
3. **–ò–∑–æ–ª—è—Ü–∏—è**: –ü—Ä–æ–±–ª–µ–º—ã –≤ –æ–¥–Ω–æ–º —Ä–æ—É—Ç–µ—Ä–µ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ
4. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ö–∞–∂–¥—ã–π —Ä–æ—É—Ç–µ—Ä –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ
5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞

---

## ‚ùì –ó–∞—á–µ–º –Ω—É–∂–Ω—ã —Ä–æ—É—Ç–µ—Ä—ã?

### –ü—Ä–æ–±–ª–µ–º—ã –±–µ–∑ —Ä–æ—É—Ç–µ—Ä–æ–≤

–î–∞–≤–∞–π—Ç–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç –±–æ—Ç –±–µ–∑ —Ä–æ—É—Ç–µ—Ä–æ–≤:

```python
# bot_without_routers.py
from aiogram import Bot, Dispatcher, types
from aiogram.filters import Command

bot = Bot(token="TOKEN")
dp = Dispatcher()

# –í—Å–µ —Ö–µ–Ω–¥–ª–µ—Ä—ã –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
@dp.message(Command("start"))
async def cmd_start(message: types.Message):
    await message.answer("–ü—Ä–∏–≤–µ—Ç!")

@dp.message(Command("help"))
async def cmd_help(message: types.Message):
    await message.answer("–ü–æ–º–æ—â—å")

@dp.message(Command("admin"))
async def cmd_admin(message: types.Message):
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∞
    if message.from_user.id not in ADMIN_IDS:
        await message.answer("–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω")
        return
    await message.answer("–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å")

@dp.message(Command("settings"))
async def cmd_settings(message: types.Message):
    await message.answer("–ù–∞—Å—Ç—Ä–æ–π–∫–∏")

# –ò —Ç–∞–∫ –¥–∞–ª–µ–µ... 100+ —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
```

**–ü—Ä–æ–±–ª–µ–º—ã —Ç–∞–∫–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:**
1. **–û–≥—Ä–æ–º–Ω—ã–π —Ñ–∞–π–ª**: –°–æ—Ç–Ω–∏ —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
2. **–°–ª–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –Ω—É–∂–Ω–æ–µ**: –¢—Ä—É–¥–Ω–æ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –∫–æ–¥–µ
3. **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏–º–µ–Ω**: –î–≤–∞ —Ö–µ–Ω–¥–ª–µ—Ä–∞ –º–æ–≥—É—Ç –∏–º–µ—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∏–º–µ–Ω–∞
4. **–°–ª–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å**: –ù–µ–ª—å–∑—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é —á–∞—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
5. **–°–ª–æ–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å**: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å –≤—Å—ë

### –†–µ—à–µ–Ω–∏–µ —Å —Ä–æ—É—Ç–µ—Ä–∞–º–∏

–¢–µ–ø–µ—Ä—å –ø–æ—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ —Ç–æ—Ç –∂–µ –±–æ—Ç –≤—ã–≥–ª—è–¥–∏—Ç —Å —Ä–æ—É—Ç–µ—Ä–∞–º–∏:

```python
# main.py
from aiogram import Bot, Dispatcher
from handlers.user import user_router
from handlers.admin import admin_router

bot = Bot(token="TOKEN")
dp = Dispatcher()

# –ü–æ–¥–∫–ª—é—á–∞–µ–º —Ä–æ—É—Ç–µ—Ä—ã
dp.include_router(user_router)
dp.include_router(admin_router)
```

```python
# handlers/user.py
from aiogram import Router, types
from aiogram.filters import Command

user_router = Router()

@user_router.message(Command("start"))
async def cmd_start(message: types.Message):
    await message.answer("–ü—Ä–∏–≤–µ—Ç!")

@user_router.message(Command("help"))
async def cmd_help(message: types.Message):
    await message.answer("–ü–æ–º–æ—â—å")

@user_router.message(Command("settings"))
async def cmd_settings(message: types.Message):
    await message.answer("–ù–∞—Å—Ç—Ä–æ–π–∫–∏")
```

```python
# handlers/admin.py
from aiogram import Router, types
from aiogram.filters import Command

admin_router = Router()

@admin_router.message(Command("admin"))
async def cmd_admin(message: types.Message):
    if message.from_user.id not in ADMIN_IDS:
        await message.answer("–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω")
        return
    await message.answer("–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å")
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ç–∞–∫–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:**
1. **–ß–∏—Å—Ç—ã–π –∫–æ–¥**: –ö–∞–∂–¥—ã–π —Ñ–∞–π–ª –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–≤–æ—é –æ–±–ª–∞—Å—Ç—å
2. **–õ–µ–≥–∫–æ –Ω–∞–π—Ç–∏ –Ω—É–∂–Ω–æ–µ**: –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã –≤ user.py
3. **–ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤**: –ò–º–µ–Ω–∞ —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤ –Ω–µ –ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç—Å—è
4. **–õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å**: –ú–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π —Ä–æ—É—Ç–µ—Ä –æ—Ç–¥–µ–ª—å–Ω–æ
5. **–õ–µ–≥–∫–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å**: –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–¥–Ω–æ–º –º–æ–¥—É–ª–µ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ

### –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

–†–æ—É—Ç–µ—Ä—ã –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω—ã –¥–ª—è –±–æ–ª—å—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤:

```
–ë–æ–ª—å—à–æ–π –ø—Ä–æ–µ–∫—Ç –±–µ–∑ —Ä–æ—É—Ç–µ—Ä–æ–≤:
bot.py (5000+ —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ 100+ —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤
‚îú‚îÄ‚îÄ –°–º–µ—à–∞–Ω–Ω—ã–π –∫–æ–¥
‚îî‚îÄ‚îÄ –°–ª–æ–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å

–ë–æ–ª—å—à–æ–π –ø—Ä–æ–µ–∫—Ç —Å —Ä–æ—É—Ç–µ—Ä–∞–º–∏:
bot.py (50 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îú‚îÄ‚îÄ user.py (200 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ admin.py (150 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ payment.py (300 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ game.py (400 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îî‚îÄ‚îÄ support.py (250 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ keyboards/
‚îú‚îÄ‚îÄ services/
‚îî‚îÄ‚îÄ utils/
```

---

## üõ†Ô∏è –°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–æ–≤

### –ë–∞–∑–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä

–°–æ–∑–¥–∞—Ç—å —Ä–æ—É—Ç–µ—Ä –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ. –î–∞–≤–∞–π—Ç–µ –ø–æ—à–∞–≥–æ–≤–æ —Ä–∞–∑–±–µ—Ä–µ–º –ø—Ä–æ—Ü–µ—Å—Å:

#### –®–∞–≥ 1: –ò–º–ø–æ—Ä—Ç Router
```python
from aiogram import Router
```

#### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ —Ä–æ—É—Ç–µ—Ä–∞
```python
user_router = Router()
```

#### –®–∞–≥ 3: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤
```python
@user_router.message(Command("start"))
async def cmd_start(message: types.Message):
    await message.answer("–ü—Ä–∏–≤–µ—Ç!")
```

#### –®–∞–≥ 4: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –¥–∏—Å–ø–µ—Ç—á–µ—Ä—É
```python
from aiogram import Dispatcher

dp = Dispatcher()
dp.include_router(user_router)
```

**–ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä:**

```python
# handlers/user.py
from aiogram import Router, types
from aiogram.filters import Command

# –®–∞–≥ 2: –°–æ–∑–¥–∞–µ–º —Ä–æ—É—Ç–µ—Ä
user_router = Router()

# –®–∞–≥ 3: –î–æ–±–∞–≤–ª—è–µ–º —Ö–µ–Ω–¥–ª–µ—Ä—ã
@user_router.message(Command("start"))
async def cmd_start(message: types.Message):
    await message.answer(
        "üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!\n\n"
        "–Ø –≤–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç.\n"
        "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /help –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–æ–º–∞–Ω–¥."
    )

@user_router.message(Command("help"))
async def cmd_help(message: types.Message):
    help_text = """
ü§ñ –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
/start - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É
/help - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É
/profile - –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å
/settings - –ù–∞—Å—Ç—Ä–æ–π–∫–∏
    """
    await message.answer(help_text)

@user_router.message(Command("profile"))
async def cmd_profile(message: types.Message):
    await message.answer(
        f"üë§ –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å:\n\n"
        f"ID: {message.from_user.id}\n"
        f"–ò–º—è: {message.from_user.full_name}\n"
        f"Username: @{message.from_user.username}"
    )
```

```python
# main.py
from aiogram import Bot, Dispatcher
from handlers.user import user_router  # –®–∞–≥ 1: –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º

bot = Bot(token="YOUR_TOKEN")
dp = Dispatcher()

# –®–∞–≥ 4: –ü–æ–¥–∫–ª—é—á–∞–µ–º —Ä–æ—É—Ç–µ—Ä
dp.include_router(user_router)

async def main():
    await dp.start_polling(bot)

if __name__ == "__main__":
    import asyncio
    asyncio.run(main())
```

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤

–í —Ä–æ—É—Ç–µ—Ä–∞—Ö –º–æ–∂–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ç–∏–ø—ã —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤, –∫–∞–∫ –∏ –≤ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–µ:

```python
from aiogram import Router, F, types
from aiogram.filters import Command, StateFilter
from aiogram.types import CallbackQuery

user_router = Router()

# –ö–æ–º–∞–Ω–¥—ã
@user_router.message(Command("start"))
async def cmd_start(message: types.Message):
    await message.answer("–ü—Ä–∏–≤–µ—Ç!")

# –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
@user_router.message(F.text == "–ø–æ–º–æ—â—å")
async def text_help(message: types.Message):
    await message.answer("–ß–µ–º –ø–æ–º–æ—á—å?")

# –§–æ—Ç–æ
@user_router.message(F.photo)
async def handle_photo(message: types.Message):
    await message.answer("–ö—Ä–∞—Å–∏–≤–æ–µ —Ñ–æ—Ç–æ!")

# Callback-–∑–∞–ø—Ä–æ—Å—ã
@user_router.callback_query(F.data.startswith("button_"))
async def handle_callback(callback: CallbackQuery):
    await callback.answer("–ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞!")

# –°–æ—Å—Ç–æ—è–Ω–∏—è (FSM)
@user_router.message(StateFilter("waiting_for_text"))
async def handle_state_message(message: types.Message):
    await message.answer("–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏!")
```

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –¥–∏—Å–ø–µ—Ç—á–µ—Ä—É

–†–æ—É—Ç–µ—Ä—ã –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å —Ä–∞–∑–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏:

#### –ü—Ä–æ—Å—Ç–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
```python
dp.include_router(user_router)
```

#### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º
```python
dp.include_router(user_router, prefix="/user")
```

#### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–æ—É—Ç–µ—Ä–æ–≤
```python
dp.include_router(user_router)
dp.include_router(admin_router)
dp.include_router(payment_router)
```

#### –£—Å–ª–æ–≤–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
```python
if DEBUG:
    dp.include_router(debug_router)
```

### –§–∏–ª—å—Ç—Ä—ã –≤ —Ä–æ—É—Ç–µ—Ä–∞—Ö

–†–æ—É—Ç–µ—Ä—ã –º–æ–≥—É—Ç –∏–º–µ—Ç—å –æ–±—â–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è –≤—Å–µ—Ö —Å–≤–æ–∏—Ö —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤:

```python
from aiogram.filters import AdminFilter

# –†–æ—É—Ç–µ—Ä —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
admin_router = Router()
admin_router.message.filter(AdminFilter(is_admin=True))

@admin_router.message(Command("stats"))
async def admin_stats(message: types.Message):
    # –≠—Ç–æ—Ç —Ö–µ–Ω–¥–ª–µ—Ä –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
    await message.answer("–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞")
```

–ú–æ–∂–Ω–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã:

```python
from aiogram.filters import ChatTypeFilter

# –†–æ—É—Ç–µ—Ä —Ç–æ–ª—å–∫–æ –¥–ª—è –≥—Ä—É–ø–ø
group_router = Router()
group_router.message.filter(ChatTypeFilter(types.ChatType.GROUP))

@group_router.message(F.text.startswith("/ban"))
async def group_ban(message: types.Message):
    # –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ –≥—Ä—É–ø–ø–∞—Ö
    await message.answer("–ö–æ–º–∞–Ω–¥–∞ /ban")
```

---

## üèóÔ∏è –í–ª–æ–∂–µ–Ω–Ω—ã–µ —Ä–æ—É—Ç–µ—Ä—ã

### –ò–µ—Ä–∞—Ä—Ö–∏—è —Ä–æ—É—Ç–µ—Ä–æ–≤

–†–æ—É—Ç–µ—Ä—ã –º–æ–∂–Ω–æ –≤–∫–ª–∞–¥—ã–≤–∞—Ç—å –¥—Ä—É–≥ –≤ –¥—Ä—É–≥–∞, —Å–æ–∑–¥–∞–≤–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É. –≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ —Å —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–æ–π.

**–ü—Ä–∏–º–µ—Ä –∏–µ—Ä–∞—Ä—Ö–∏–∏:**
```
Main Router
‚îú‚îÄ‚îÄ User Router
‚îÇ   ‚îú‚îÄ‚îÄ Profile Router
‚îÇ   ‚îî‚îÄ‚îÄ Settings Router
‚îú‚îÄ‚îÄ Admin Router
‚îÇ   ‚îú‚îÄ‚îÄ Stats Router
‚îÇ   ‚îî‚îÄ‚îÄ Manage Router
‚îî‚îÄ‚îÄ Payment Router
    ‚îú‚îÄ‚îÄ Create Router
    ‚îî‚îÄ‚îÄ Check Router
```

### –ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ middleware

–û–¥–Ω–æ –∏–∑ –≥–ª–∞–≤–Ω—ã—Ö –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ä–æ—É—Ç–µ—Ä–æ–≤ ‚Äî –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ middleware. Middleware, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º —Ä–æ—É—Ç–µ—Ä–µ, –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ –≤—Å–µ–º –¥–æ—á–µ—Ä–Ω–∏–º.

```python
from aiogram import Router

# –ì–ª–∞–≤–Ω—ã–π —Ä–æ—É—Ç–µ—Ä
main_router = Router()

# Middleware –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ —Ä–æ—É—Ç–µ—Ä–∞
@main_router.message.middleware()
async def main_middleware(handler, event, data):
    print("Main middleware")
    return await handler(event, data)

# –î–æ—á–µ—Ä–Ω–∏–π —Ä–æ—É—Ç–µ—Ä
user_router = Router()

# Middleware –¥–ª—è –¥–æ—á–µ—Ä–Ω–µ–≥–æ —Ä–æ—É—Ç–µ—Ä–∞
@user_router.message.middleware()
async def user_middleware(handler, event, data):
    print("User middleware")
    return await handler(event, data)

# –í–∫–ª–∞–¥—ã–≤–∞–µ–º —Ä–æ—É—Ç–µ—Ä—ã
main_router.include_router(user_router)

# –ü—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è:
# 1. –°—Ä–∞–±–æ—Ç–∞–µ—Ç main_middleware
# 2. –°—Ä–∞–±–æ—Ç–∞–µ—Ç user_middleware
# 3. –°—Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–µ–Ω–¥–ª–µ—Ä
```

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä

–î–∞–≤–∞–π—Ç–µ —Å–æ–∑–¥–∞–¥–∏–º —Å–ª–æ–∂–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ —Ä–æ—É—Ç–µ—Ä–∞–º–∏:

```python
# routers/main.py
from aiogram import Router
from routers.user import user_router
from routers.admin import admin_router

main_router = Router()

# Middleware –¥–ª—è –≤—Å–µ—Ö —Ä–æ—É—Ç–µ—Ä–æ–≤
@main_router.message.middleware()
async def auth_middleware(handler, event, data):
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
    if not hasattr(event, 'from_user'):
        return await handler(event, data)
    
    # –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –¥–∞–Ω–Ω—ã–µ
    data['user'] = event.from_user
    return await handler(event, data)

# –ü–æ–¥–∫–ª—é—á–∞–µ–º –¥–æ—á–µ—Ä–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä—ã
main_router.include_router(user_router)
main_router.include_router(admin_router)
```

```python
# routers/user.py
from aiogram import Router
from routers.user.profile import profile_router
from routers.user.settings import settings_router

user_router = Router()

# Middleware —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ä–æ—É—Ç–µ—Ä–æ–≤
@user_router.message.middleware()
async def user_middleware(handler, event, data):
    print("–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞")
    return await handler(event, data)

# –ü–æ–¥–∫–ª—é—á–∞–µ–º –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Ä–æ—É—Ç–µ—Ä—ã
user_router.include_router(profile_router)
user_router.include_router(settings_router)

@user_router.message(Command("user_menu"))
async def user_menu(message: types.Message):
    await message.answer("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ –º–µ–Ω—é")
```

```python
# routers/user/profile.py
from aiogram import Router

profile_router = Router()

@profile_router.message(Command("profile"))
async def user_profile(message: types.Message):
    await message.answer("–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å")
```

```python
# routers/admin.py
from aiogram import Router
from aiogram.filters import AdminFilter

admin_router = Router()

# –§–∏–ª—å—Ç—Ä —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
admin_router.message.filter(AdminFilter(is_admin=True))

@admin_router.message(Command("admin_panel"))
async def admin_panel(message: types.Message):
    await message.answer("–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å")
```

```python
# main.py
from aiogram import Bot, Dispatcher
from routers.main import main_router

bot = Bot(token="TOKEN")
dp = Dispatcher()

# –ü–æ–¥–∫–ª—é—á–∞–µ–º –≥–ª–∞–≤–Ω—ã–π —Ä–æ—É—Ç–µ—Ä
dp.include_router(main_router)

async def main():
    await dp.start_polling(bot)
```

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `auth_middleware`
2. –ó–∞—Ç–µ–º `user_middleware` (–µ—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ)
3. –ó–∞—Ç–µ–º —Ö–µ–Ω–¥–ª–µ—Ä –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º –≤–ª–æ–∂–µ–Ω–Ω–æ–º —Ä–æ—É—Ç–µ—Ä–µ

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –ü–æ—á–µ–º—É –≤–∞–∂–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞?

–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ ‚Äî —ç—Ç–æ –∫–∞–∫ —Ö–æ—Ä–æ—à–∏–π —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –¥–ª—è –¥–æ–º–∞. –ë–µ–∑ –Ω–µ–≥–æ –≤—Å—ë —Ä–∞–∑–≤–∞–ª–∏—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∂–µ –∏–∑–º–µ–Ω–µ–Ω–∏–∏.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ö–æ—Ä–æ—à–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:**
1. **–ü–æ–Ω—è—Ç–Ω–æ—Å—Ç—å**: –ù–æ–≤—ã–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –±—ã—Å—Ç—Ä–æ —Ä–∞–∑–±–µ—Ä–µ—Ç—Å—è –≤ –∫–æ–¥–µ
2. **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –≤–Ω–æ—Å–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
3. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –±–µ–∑ —Å–ª–æ–º–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ
4. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è
5. **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –ú–æ–¥—É–ª–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

–î–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:

```
my_bot/
‚îú‚îÄ‚îÄ venv/                           # –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ .env                             # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ .gitignore                       # –§–∞–π–ª—ã –¥–ª—è Git
‚îú‚îÄ‚îÄ requirements.txt                 # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ bot.py                           # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ config.py                        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ README.md                        # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ
‚îú‚îÄ‚îÄ handlers/                        # –•–µ–Ω–¥–ª–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ user/                        # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ö–µ–Ω–¥–ª–µ—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py                  # –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ profile.py               # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–º
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ settings.py              # –ù–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ admin/                       # –ê–¥–º–∏–Ω—Å–∫–∏–µ —Ö–µ–Ω–¥–ª–µ—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stats.py                 # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ manage.py                # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ broadcast.py             # –†–∞—Å—Å—ã–ª–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ payment/                     # –ü–ª–∞—Ç–µ–∂–Ω—ã–µ —Ö–µ–Ω–¥–ª–µ—Ä—ã
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îú‚îÄ‚îÄ create.py                # –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
‚îÇ       ‚îî‚îÄ‚îÄ check.py                 # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–∞—Ç–µ–∂–∞
‚îÇ
‚îú‚îÄ‚îÄ keyboards/                       # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ user_keyboards.py            # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ admin_keyboards.py           # –ê–¥–º–∏–Ω—Å–∫–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îî‚îÄ‚îÄ payment_keyboards.py         # –ü–ª–∞—Ç–µ–∂–Ω—ã–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ
‚îú‚îÄ‚îÄ services/                        # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ user_service.py              # –°–µ—Ä–≤–∏—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ payment_service.py           # –°–µ—Ä–≤–∏—Å –ø–ª–∞—Ç–µ–∂–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ notification_service.py      # –°–µ—Ä–≤–∏—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ database.py                  # –†–∞–±–æ—Ç–∞ —Å –ë–î
‚îÇ
‚îú‚îÄ‚îÄ models/                          # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ user.py                      # –ú–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îú‚îÄ‚îÄ payment.py                   # –ú–æ–¥–µ–ª—å –ø–ª–∞—Ç–µ–∂–∞
‚îÇ   ‚îî‚îÄ‚îÄ database.py                  # –ú–æ–¥–µ–ª–∏ –ë–î
‚îÇ
‚îú‚îÄ‚îÄ utils/                           # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ decorators.py                # –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ helpers.py                   # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ validators.py                # –í–∞–ª–∏–¥–∞—Ç–æ—Ä—ã
‚îÇ   ‚îî‚îÄ‚îÄ formatters.py               # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ
‚îú‚îÄ‚îÄ middlewares/                     # –ú–∏–¥–ª–≤–∞—Ä–∏
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ auth_middleware.py           # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ logging_middleware.py        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ throttling_middleware.py     # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã
‚îÇ
‚îú‚îÄ‚îÄ filters/                         # –§–∏–ª—å—Ç—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ admin_filter.py              # –§–∏–ª—å—Ç—Ä –∞–¥–º–∏–Ω–∞
‚îÇ   ‚îú‚îÄ‚îÄ user_filter.py               # –§–∏–ª—å—Ç—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îî‚îÄ‚îÄ payment_filter.py            # –§–∏–ª—å—Ç—Ä –ø–ª–∞—Ç–µ–∂–µ–π
‚îÇ
‚îú‚îÄ‚îÄ database/                        # –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ connection.py                # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ migrations/                  # –ú–∏–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ seeds/                       # –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îÇ
‚îú‚îÄ‚îÄ tests/                           # –¢–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ test_handlers.py             # –¢–µ—Å—Ç—ã —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ test_services.py             # –¢–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ fixtures/                   # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îÇ
‚îú‚îÄ‚îÄ static/                          # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ images/                      # –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ documents/                   # –î–æ–∫—É–º–µ–Ω—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ audio/                       # –ê—É–¥–∏–æ
‚îÇ
‚îî‚îÄ‚îÄ logs/                            # –õ–æ–≥–∏
    ‚îú‚îÄ‚îÄ bot.log                      # –õ–æ–≥ –±–æ—Ç–∞
    ‚îî‚îÄ‚îÄ errors.log                   # –õ–æ–≥ –æ—à–∏–±–æ–∫
```

### –û–ø–∏—Å–∞–Ω–∏–µ –ø–∞–ø–æ–∫ –∏ —Ñ–∞–π–ª–æ–≤

#### üìÅ handlers/
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π (—Ö–µ–Ω–¥–ª–µ—Ä—ã)
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞**:
- `user/` ‚Äî —Ö–µ–Ω–¥–ª–µ—Ä—ã –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `admin/` ‚Äî —Ö–µ–Ω–¥–ª–µ—Ä—ã –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- `payment/` ‚Äî —Ö–µ–Ω–¥–ª–µ—Ä—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–ª–∞—Ç–µ–∂–∞–º–∏

**–ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞** (`handlers/user/base.py`):
```python
from aiogram import Router, types
from aiogram.filters import Command

user_router = Router()

@user_router.message(Command("start"))
async def cmd_start(message: types.Message):
    await message.answer("–ü—Ä–∏–≤–µ—Ç!")
```

#### üìÅ keyboards/
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –í—Å–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (reply –∏ inline)
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞**:
- `user_keyboards.py` ‚Äî –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `admin_keyboards.py` ‚Äî –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –∞–¥–º–∏–Ω–æ–≤

**–ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞** (`keyboards/user_keyboards.py`):
```python
from aiogram.utils.keyboard import ReplyKeyboardBuilder, InlineKeyboardBuilder
from aiogram.types import KeyboardButton, InlineKeyboardButton

def get_main_keyboard():
    builder = ReplyKeyboardBuilder()
    builder.add(KeyboardButton(text="üè† –ì–ª–∞–≤–Ω–∞—è"))
    builder.add(KeyboardButton(text="üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"))
    builder.adjust(2)
    return builder.as_markup(resize_keyboard=True)

def get_profile_keyboard():
    builder = InlineKeyboardBuilder()
    builder.add(InlineKeyboardButton(text="‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å", callback_data="edit_profile"))
    builder.add(InlineKeyboardButton(text="üîô –ù–∞–∑–∞–¥", callback_data="back_to_menu"))
    return builder.as_markup()
```

#### üìÅ services/
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞**:
- `user_service.py` ‚Äî —Ä–∞–±–æ—Ç–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- `payment_service.py` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π

**–ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞** (`services/user_service.py`):
```python
class UserService:
    def __init__(self, db_connection):
        self.db = db_connection
    
    async def get_user(self, user_id: int):
        # –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î
        pass
    
    async def create_user(self, user_data: dict):
        # –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        pass
```

#### üìÅ models/
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (ORM, Pydantic –º–æ–¥–µ–ª–∏)
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞**:
- `user.py` ‚Äî –º–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `payment.py` ‚Äî –º–æ–¥–µ–ª—å –ø–ª–∞—Ç–µ–∂–∞

**–ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞** (`models/user.py`):
```python
from sqlalchemy import Column, Integer, String, DateTime
from sqlalchemy.ext.declarative import declarative_base

Base = declarative_base()

class User(Base):
    __tablename__ = "users"
    
    id = Column(Integer, primary_key=True)
    telegram_id = Column(Integer, unique=True)
    username = Column(String)
    first_name = Column(String)
    last_name = Column(String)
    created_at = Column(DateTime)
```

#### üìÅ utils/
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —É—Ç–∏–ª–∏—Ç—ã
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞**:
- `helpers.py` ‚Äî –æ–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
- `validators.py` ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- `formatters.py` ‚Äî —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–≤–æ–¥–∞

**–ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞** (`utils/helpers.py`):
```python
def format_datetime(dt):
    """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è"""
    return dt.strftime("%d.%m.%Y %H:%M")

def escape_markdown(text):
    """–≠–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç —Å–∏–º–≤–æ–ª—ã Markdown"""
    escape_chars = '_*[]()~`>#+-=|{}.!'
    return ''.join(f'\\{char}' if char in escape_chars else char for char in text)
```

#### üìÅ middlewares/
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞**:
- `auth_middleware.py` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- `logging_middleware.py` ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤

**–ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞** (`middlewares/auth_middleware.py`):
```python
async def auth_middleware(handler, event, data):
    if hasattr(event, 'from_user'):
        user_id = event.from_user.id
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
        if not await check_user_access(user_id):
            await event.answer("–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω")
            return
    return await handler(event, data)
```

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

–ü–æ –º–µ—Ä–µ —Ä–æ—Å—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–∂–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å—Å—è:

#### –î–ª—è —Å—Ä–µ–¥–Ω–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞:
```
my_bot/
‚îú‚îÄ‚îÄ domains/                          # –î–æ–º–µ–Ω—ã (DDD)
‚îÇ   ‚îú‚îÄ‚îÄ user/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ models/
‚îÇ   ‚îî‚îÄ‚îÄ payment/
‚îÇ       ‚îú‚îÄ‚îÄ handlers/
‚îÇ       ‚îú‚îÄ‚îÄ services/
‚îÇ       ‚îî‚îÄ‚îÄ models/
```

#### –î–ª—è –∫—Ä—É–ø–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞:
```
my_bot/
‚îú‚îÄ‚îÄ apps/                            # –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è (Django-style)
‚îÇ   ‚îú‚îÄ‚îÄ users/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handlers.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ views.py
‚îÇ   ‚îî‚îÄ‚îÄ payments/
‚îÇ       ‚îú‚îÄ‚îÄ handlers.py
‚îÇ       ‚îú‚îÄ‚îÄ services.py
‚îÇ       ‚îú‚îÄ‚îÄ models.py
‚îÇ       ‚îî‚îÄ‚îÄ views.py
```

#### –î–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤:
```
my_bot_microservices/
‚îú‚îÄ‚îÄ user-service/
‚îú‚îÄ‚îÄ payment-service/
‚îú‚îÄ‚îÄ notification-service/
‚îî‚îÄ‚îÄ gateway/
```

---

## üìã –ü—Ä–∏–º–µ—Ä—ã —Å—Ç—Ä—É–∫—Ç—É—Ä

### –ü—Ä–æ—Å—Ç–æ–π –±–æ—Ç

–î–ª—è –Ω–µ–±–æ–ª—å—à–æ–≥–æ –±–æ—Ç–∞ (–¥–æ 20 —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤):

```
simple_bot/
‚îú‚îÄ‚îÄ venv/
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ bot.py
‚îú‚îÄ‚îÄ config.py
‚îú‚îÄ‚îÄ handlers.py
‚îú‚îÄ‚îÄ keyboards.py
‚îî‚îÄ‚îÄ utils.py
```

**bot.py**:
```python
from aiogram import Bot, Dispatcher
from handlers import dp
from config import TOKEN

bot = Bot(token=TOKEN)

async def main():
    await dp.start_polling(bot)

if __name__ == "__main__":
    import asyncio
    asyncio.run(main())
```

**handlers.py**:
```python
from aiogram import Router, types
from aiogram.filters import Command
from keyboards import get_main_keyboard

dp = Router()

@dp.message(Command("start"))
async def cmd_start(message: types.Message):
    await message.answer("–ü—Ä–∏–≤–µ—Ç!", reply_markup=get_main_keyboard())
```

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ–µ–∫—Ç

–î–ª—è –±–æ—Ç–∞ —Å—Ä–µ–¥–Ω–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (20-100 —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤):

```
medium_bot/
‚îú‚îÄ‚îÄ venv/
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ bot.py
‚îú‚îÄ‚îÄ config.py
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ user.py
‚îÇ   ‚îú‚îÄ‚îÄ admin.py
‚îÇ   ‚îî‚îÄ‚îÄ payment.py
‚îú‚îÄ‚îÄ keyboards/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ user_keyboards.py
‚îÇ   ‚îî‚îÄ‚îÄ admin_keyboards.py
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ user_service.py
‚îÇ   ‚îî‚îÄ‚îÄ payment_service.py
‚îî‚îÄ‚îÄ utils/
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îî‚îÄ‚îÄ helpers.py
```

**bot.py**:
```python
from aiogram import Bot, Dispatcher
from handlers.user import user_router
from handlers.admin import admin_router
from handlers.payment import payment_router
from config import TOKEN

bot = Bot(token=TOKEN)
dp = Dispatcher()

dp.include_router(user_router)
dp.include_router(admin_router)
dp.include_router(payment_router)

async def main():
    await dp.start_polling(bot)

if __name__ == "__main__":
    import asyncio
    asyncio.run(main())
```

### –ö—Ä—É–ø–Ω—ã–π –ø—Ä–æ–µ–∫—Ç

–î–ª—è —Å–ª–æ–∂–Ω–æ–≥–æ –±–æ—Ç–∞ (100+ —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤):

```
large_bot/
‚îú‚îÄ‚îÄ venv/
‚îú‚îÄ‚îÄ .env
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ bot.py
‚îú‚îÄ‚îÄ config.py
‚îú‚îÄ‚îÄ database.py
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ user/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ profile.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ settings.py
‚îÇ   ‚îú‚îÄ‚îÄ admin/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stats.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ manage.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ broadcast.py
‚îÇ   ‚îú‚îÄ‚îÄ payment/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ check.py
‚îÇ   ‚îî‚îÄ‚îÄ support/
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îú‚îÄ‚îÄ tickets.py
‚îÇ       ‚îî‚îÄ‚îÄ faq.py
‚îú‚îÄ‚îÄ keyboards/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ user_keyboards.py
‚îÇ   ‚îú‚îÄ‚îÄ admin_keyboards.py
‚îÇ   ‚îî‚îÄ‚îÄ payment_keyboards.py
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ user_service.py
‚îÇ   ‚îú‚îÄ‚îÄ payment_service.py
‚îÇ   ‚îú‚îÄ‚îÄ notification_service.py
‚îÇ   ‚îî‚îÄ‚îÄ analytics_service.py
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ user.py
‚îÇ   ‚îú‚îÄ‚îÄ payment.py
‚îÇ   ‚îî‚îÄ‚îÄ analytics.py
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ decorators.py
‚îÇ   ‚îú‚îÄ‚îÄ helpers.py
‚îÇ   ‚îî‚îÄ‚îÄ validators.py
‚îú‚îÄ‚îÄ middlewares/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ auth_middleware.py
‚îÇ   ‚îú‚îÄ‚îÄ logging_middleware.py
‚îÇ   ‚îî‚îÄ‚îÄ throttling_middleware.py
‚îú‚îÄ‚îÄ filters/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ admin_filter.py
‚îÇ   ‚îî‚îÄ‚îÄ user_filter.py
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ test_handlers.py
‚îÇ   ‚îî‚îÄ‚îÄ test_services.py
‚îî‚îÄ‚îÄ static/
    ‚îú‚îÄ‚îÄ images/
    ‚îî‚îÄ‚îÄ documents/
```

### –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–î–ª—è –æ—á–µ–Ω—å –∫—Ä—É–ø–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤:

```
microservice_bot/
‚îú‚îÄ‚îÄ user-service/
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handlers.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ models.py
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ payment-service/
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handlers.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ models.py
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ notification-service/
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handlers.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ models.py
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ gateway/
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routers.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config.py
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îî‚îÄ‚îÄ docker-compose.yml
```

---

## üí° –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∫–æ–¥–∞

#### 1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ __init__.py
–í –∫–∞–∂–¥–æ–π –ø–∞–ø–∫–µ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ `__init__.py` –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞:

```python
# handlers/__init__.py
from .user import user_router
from .admin import admin_router
from .payment import payment_router

__all__ = ['user_router', 'admin_router', 'payment_router']
```

#### 2. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Ä–æ—É—Ç–µ—Ä—ã –≤ main.py
```python
# main.py
from handlers import user_router, admin_router, payment_router

dp.include_router(user_router)
dp.include_router(admin_router)
dp.include_router(payment_router)
```

#### 3. –†–∞–∑–¥–µ–ª—è–π—Ç–µ —Ä–æ—É—Ç–µ—Ä—ã –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
```python
# –•–æ—Ä–æ—à–æ
handlers/
‚îú‚îÄ‚îÄ user.py      # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îú‚îÄ‚îÄ admin.py     # –ê–¥–º–∏–Ω—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îî‚îÄ‚îÄ payment.py   # –ü–ª–∞—Ç–µ–∂–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

# –ü–ª–æ—Ö–æ
handlers/
‚îú‚îÄ‚îÄ part1.py     # –°–ª—É—á–∞–π–Ω—ã–π –Ω–∞–±–æ—Ä —Ñ—É–Ω–∫—Ü–∏–π
‚îú‚îÄ‚îÄ part2.py     # –ï—â–µ –æ–¥–∏–Ω —Å–ª—É—á–∞–π–Ω—ã–π –Ω–∞–±–æ—Ä
‚îî‚îÄ‚îÄ part3.py     # –ò –µ—â–µ –æ–¥–∏–Ω
```

### –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–æ–≤

#### 1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ –∏–º–µ–Ω–∞
```python
# –•–æ—Ä–æ—à–æ
user_router = Router()
admin_router = Router()
payment_router = Router()

# –ü–ª–æ—Ö–æ
router1 = Router()
router2 = Router()
router3 = Router()
```

#### 2. –î–æ–±–∞–≤–ª—è–π—Ç–µ –ø—Ä–µ—Ñ–∏–∫—Å—ã –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
```python
# –î–ª—è —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ä—Å–∏–π API
v1_user_router = Router()
v2_user_router = Router()

# –î–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º
web_user_router = Router()
mobile_user_router = Router()
```

### –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

#### 1. –•–µ–Ω–¥–ª–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ç–æ–Ω–∫–∏–º–∏
```python
# –ü–ª–æ—Ö–æ - –≤—Å—è –ª–æ–≥–∏–∫–∞ –≤ —Ö–µ–Ω–¥–ª–µ—Ä–µ
@user_router.message(Command("profile"))
async def cmd_profile(message: types.Message):
    user = await db.fetch("SELECT * FROM users WHERE id = $1", message.from_user.id)
    if user:
        text = f"–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å: {user['name']}"
        await message.answer(text)
    else:
        await message.answer("–ü—Ä–æ—Ñ–∏–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω")

# –•–æ—Ä–æ—à–æ - —Ö–µ–Ω–¥–ª–µ—Ä –≤—ã–∑—ã–≤–∞–µ—Ç —Å–µ—Ä–≤–∏—Å
@user_router.message(Command("profile"))
async def cmd_profile(message: types.Message, user_service: UserService):
    user = await user_service.get_user(message.from_user.id)
    if user:
        await message.answer(f"–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å: {user.name}")
    else:
        await message.answer("–ü—Ä–æ—Ñ–∏–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω")
```

#### 2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–µ—Ä–≤–∏—Å—ã –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
```python
# services/user_service.py
class UserService:
    async def get_user(self, user_id: int):
        # –õ–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        pass
    
    async def create_user(self, user_data: dict):
        # –õ–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        pass
```

#### 3. –í—ã–Ω–æ—Å–∏—Ç–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
```python
# keyboards/user_keyboards.py
def get_profile_keyboard():
    builder = InlineKeyboardBuilder()
    builder.add(InlineKeyboardButton(text="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å", callback_data="edit_profile"))
    return builder.as_markup()
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### 1. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ä–æ—É—Ç–µ—Ä—ã –æ—Ç–¥–µ–ª—å–Ω–æ
```python
# tests/test_user_router.py
import pytest
from handlers.user import user_router

@pytest.mark.asyncio
async def test_start_command():
    # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    message = MockMessage(text="/start")
    
    # –í—ã–∑—ã–≤–∞–µ–º —Ö–µ–Ω–¥–ª–µ—Ä
    await user_router.message.handlers[0].callback(message)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    assert message.answer.called
    assert "–ü—Ä–∏–≤–µ—Ç" in message.answer.call_args[0][0]
```

#### 2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã
```python
# tests/conftest.py
@pytest.fixture
def user_router():
    from handlers.user import user_router
    return user_router

@pytest.fixture
def mock_message():
    return MockMessage(text="/start")
```

#### 3. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å–µ—Ä–≤–∏—Å—ã –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤
```python
# tests/test_user_service.py
@pytest.mark.asyncio
async def test_get_user():
    service = UserService(mock_db)
    user = await service.get_user(123)
    assert user.id == 123
```

---

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ú—ã –∏–∑—É—á–∏–ª–∏ –æ–¥–Ω—É –∏–∑ —Å–∞–º—ã—Ö –≤–∞–∂–Ω—ã—Ö —Ç–µ–º –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –±–æ—Ç–æ–≤ –Ω–∞ aiogram 3.x ‚Äî —Ä–æ—É—Ç–µ—Ä—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∫–æ–¥–∞ ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ "–∫—Ä–∞—Å–∏–≤–æ—Å—Ç—å", –∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

### –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã:

1. **–†–æ—É—Ç–µ—Ä—ã** ‚Äî —ç—Ç–æ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤
2. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞** –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ª–æ–≥–∏—á–Ω–æ–π –∏ –ø–æ–Ω—è—Ç–Ω–æ–π
3. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏** –¥–µ–ª–∞–µ—Ç –∫–æ–¥ —á–∏—â–µ –∏ –ø—Ä–æ—â–µ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫–µ
4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π

### –ß—Ç–æ –º—ã —É–∑–Ω–∞–ª–∏:

- –ö–∞–∫ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–æ—É—Ç–µ—Ä—ã
- –ö–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤—ã–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞
- –ö–∞–∫ —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Ä–æ—É—Ç–µ—Ä—ã
- –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞
- –ü—Ä–∏–º–µ—Ä—ã —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ –ø—Ä–æ–µ–∫—Ç–æ–≤

### –ß—Ç–æ –¥–∞–ª—å—à–µ?

–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –≤—ã –ø–æ–Ω–∏–º–∞–µ—Ç–µ, –∫–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤—ã–≤–∞—Ç—å –∫–æ–¥, –≤—ã –≥–æ—Ç–æ–≤—ã –∫ –∏–∑—É—á–µ–Ω–∏—é –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã—Ö —Ç–µ–º:
- –§–∏–ª—å—Ç—Ä—ã –∏ middleware (–≥–ª–∞–≤–∞ 07-–§–∏–ª—å—Ç—Ä—ã-—Å–æ–±—ã—Ç–∏–π)
- –ö–æ–Ω–µ—á–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç—ã (FSM) (–≥–ª–∞–≤–∞ 10-–ö–æ–Ω–µ—á–Ω—ã–µ-–∞–≤—Ç–æ–º–∞—Ç—ã-FSM)
- –í–µ–±—Ö—É–∫–∏ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ (–≥–ª–∞–≤–∞ 14-Webhook-–∏-—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ)

### –°–æ–≤–µ—Ç—ã –¥–ª—è –ø—Ä–∞–∫—Ç–∏–∫–∏:

1. **–ù–∞—á–Ω–∏—Ç–µ —Å –º–∞–ª–æ–≥–æ**: –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Å—Ç–æ–π –±–æ—Ç —Å —Ä–æ—É—Ç–µ—Ä–∞–º–∏
2. **–î–æ–±–∞–≤–ª—è–π—Ç–µ —Å–ª–æ–∂–Ω–æ—Å—Ç—å**: –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —Ä–∞—Å—à–∏—Ä—è–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
3. **–°–ª–µ–¥—É–π—Ç–µ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏
4. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ**: –ü–∏—à–∏—Ç–µ —Ç–µ—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–æ—É—Ç–µ—Ä–∞
5. **–†–µ—Ñ–∞–∫—Ç–æ—Ä—å—Ç–µ**: –£–ª—É—á—à–∞–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ –º–µ—Ä–µ —Ä–æ—Å—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã:

- [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è aiogram](https://docs.aiogram.dev/)
- [Python Packaging User Guide](https://packaging.python.org/)
- [Clean Architecture](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)
- [Domain-Driven Design](https://domainlanguage.com/ddd/)

---

> üí° **–í–∞–∂–Ω–æ**: –•–æ—Ä–æ—à–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –æ–∫—É–ø–∞—é—Ç—Å—è —Å–ø–æ–ª–Ω–∞ –ø—Ä–∏ —Ä–æ—Å—Ç–µ –ø—Ä–æ–µ–∫—Ç–∞. –ù–µ –ø—Ä–µ–Ω–µ–±—Ä–µ–≥–∞–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π, –¥–∞–∂–µ –µ—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –∫–∞–∂–µ—Ç—Å—è –º–∞–ª–µ–Ω—å–∫–∏–º.

> ‚ö†Ô∏è **–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ**: –í—Å–µ–≥–¥–∞ –¥—É–º–∞–π—Ç–µ –æ –±—É–¥—É—â–µ–º. –°–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –º–∞–ª–µ–Ω—å–∫–∏–π –±–æ—Ç –º–æ–∂–µ—Ç –∑–∞–≤—Ç—Ä–∞ –≤—ã—Ä–∞—Å—Ç–∏ –≤ –±–æ–ª—å—à–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.

–¢–µ–ø–µ—Ä—å –≤—ã –≥–æ—Ç–æ–≤—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ, —Ö–æ—Ä–æ—à–æ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –±–æ—Ç—ã –Ω–∞ aiogram 3.x! –£–¥–∞—á–∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ! üöÄ‚ú®