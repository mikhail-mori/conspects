# üß± –û—Å–Ω–æ–≤—ã aiogram 3.x

## üìë –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–í–≤–µ–¥–µ–Ω–∏–µ](#–≤–≤–µ–¥–µ–Ω–∏–µ)
2. [Dispatcher - —Å–µ—Ä–¥—Ü–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞](#dispatcher%20-%20—Å–µ—Ä–¥—Ü–µ%20–≤–∞—à–µ–≥–æ%20–±–æ—Ç–∞)
   - [–ß—Ç–æ —Ç–∞–∫–æ–µ Dispatcher?](#—á—Ç–æ%20—Ç–∞–∫–æ–µ%20dispatcher)
   - [–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã Dispatcher](#–æ—Å–Ω–æ–≤–Ω—ã–µ%20–º–µ—Ç–æ–¥—ã%20dispatcher)
   - [–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è](#–∂–∏–∑–Ω–µ–Ω–Ω—ã–π%20—Ü–∏–∫–ª%20–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
3. [Bot - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫ Telegram API](#bot%20-%20–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å%20–∫%20telegram%20api)
   - [–ß—Ç–æ —Ç–∞–∫–æ–µ Bot?](#—á—Ç–æ%20—Ç–∞–∫–æ–µ%20bot)
   - [–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã Bot](#–æ—Å–Ω–æ–≤–Ω—ã–µ%20–º–µ—Ç–æ–¥—ã%20bot)
   - [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Bot](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞%20bot)
4. [Router - –æ—Ä–≥–∞–Ω–∏–∑—É–µ–º –∫–æ–¥ –ª–æ–≥–∏—á–Ω–æ](#router%20-%20–æ—Ä–≥–∞–Ω–∏–∑—É–µ–º%20–∫–æ–¥%20–ª–æ–≥–∏—á–Ω–æ)
   - [–ß—Ç–æ —Ç–∞–∫–æ–µ Router?](#—á—Ç–æ%20—Ç–∞–∫–æ–µ%20router)
   - [–°–æ–∑–¥–∞–Ω–∏–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Router](#—Å–æ–∑–¥–∞–Ω–∏–µ%20–∏%20–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ%20router)
   - [–í–ª–æ–∂–µ–Ω–Ω—ã–µ —Ä–æ—É—Ç–µ—Ä—ã](#–≤–ª–æ–∂–µ–Ω–Ω—ã–µ%20—Ä–æ—É—Ç–µ—Ä—ã)
5. [–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –≤ aiogram](#–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å%20–≤%20aiogram)
   - [–ü–æ—á–µ–º—É –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–∞?](#–ø–æ—á–µ–º—É%20–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å%20–≤–∞–∂–Ω–∞)
   - [–û—Å–Ω–æ–≤—ã async/await](#–æ—Å–Ω–æ–≤—ã%20async/await)
   - [–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –≤ aiogram](#–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å%20–≤%20aiogram)
6. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞%20–ø—Ä–æ–µ–∫—Ç–∞)
   - [–ü–æ—á–µ–º—É –≤–∞–∂–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞?](#–ø–æ—á–µ–º—É%20–≤–∞–∂–Ω–∞%20—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
   - [–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞](#—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è%20—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
   - [–ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏](#–ø—Ä–∏–º–µ—Ä%20—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
7. [Dependency Injection (DI)](#dependency%20injection%20(di))
   - [–ß—Ç–æ —Ç–∞–∫–æ–µ DI?](#—á—Ç–æ%20—Ç–∞–∫–æ–µ%20di)
   - [DI –≤ aiogram](#di%20–≤%20aiogram)
   - [–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä](#–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π%20–ø—Ä–∏–º–µ—Ä)
8. [–ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∫–æ–¥–∞](#–ø–æ–ª–Ω—ã–π%20–ø—Ä–∏–º–µ—Ä%20–∫–æ–¥–∞)
9. [–ó–∞–∫–ª—é—á–µ–Ω–∏–µ](#–∑–∞–∫–ª—é—á–µ–Ω–∏–µ)

---

## üìñ –í–≤–µ–¥–µ–Ω–∏–µ

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –≥–ª–∞–≤—É, –≥–¥–µ –º—ã –ø–æ–≥—Ä—É–∑–∏–º—Å—è –≤ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ aiogram 3.x! –ï—Å–ª–∏ –≤ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≥–ª–∞–≤–∞—Ö –º—ã —É—á–∏–ª–∏—Å—å —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ—Å—Ç—ã—Ö –±–æ—Ç–æ–≤, —Ç–æ —Ç–µ–ø–µ—Ä—å —Ä–∞–∑–±–µ—Ä–µ–º, –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –∏–∑–Ω—É—Ç—Ä–∏. –ü–æ–Ω–∏–º–∞–Ω–∏–µ —ç—Ç–∏—Ö –æ—Å–Ω–æ–≤ ‚Äî –∫–ª—é—á –∫ —Å–æ–∑–¥–∞–Ω–∏—é —Å–ª–æ–∂–Ω—ã—Ö, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã—Ö –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã—Ö –±–æ—Ç–æ–≤.

**–ß—Ç–æ –º—ã –∏–∑—É—á–∏–º:**
- **Dispatcher** ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —É–∑–µ–ª, —É–ø—Ä–∞–≤–ª—è—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- **Bot** ‚Äî –≤–∞—à –º–æ—Å—Ç –∫ Telegram API
- **Router** ‚Äî –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞ –≤ –±–æ–ª—å—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å** ‚Äî –ø–æ—á–µ–º—É aiogram —Ç–∞–∫–æ–π –±—ã—Å—Ç—Ä—ã–π –∏ –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞** ‚Äî –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –∫–æ–¥
- **Dependency Injection** ‚Äî –∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å –∫–æ–¥ –≥–∏–±–∫–∏–º –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã–º

–≠—Ç–∞ –≥–ª–∞–≤–∞ –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–∞ –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ —Ö–æ—á–µ—Ç –ø–µ—Ä–µ–π—Ç–∏ –æ—Ç –ø—Ä–æ—Å—Ç—ã—Ö —ç—Ö–æ-–±–æ—Ç–æ–≤ –∫ —Å–µ—Ä—å–µ–∑–Ω—ã–º –ø—Ä–æ–µ–∫—Ç–∞–º. –ú—ã –±—É–¥–µ–º –¥–≤–∏–≥–∞—Ç—å—Å—è –æ—Ç –ø—Ä–æ—Å—Ç–æ–≥–æ –∫ —Å–ª–æ–∂–Ω–æ–º—É, —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –ø—Ä–∏–º–µ—Ä–æ–≤ –∏ –∞–Ω–∞–ª–æ–≥–∏–π –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–π –∂–∏–∑–Ω–∏.

---

## üîÑ Dispatcher - —Å–µ—Ä–¥—Ü–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞

### –ß—Ç–æ —Ç–∞–∫–æ–µ Dispatcher?

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ —Å–µ–±–µ **Dispatcher** –∫–∞–∫ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –≤–æ–∫–∑–∞–ª –±–æ–ª—å—à–æ–≥–æ –≥–æ—Ä–æ–¥–∞. –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Äî —ç—Ç–æ –ø–æ–µ–∑–¥, –ø—Ä–∏–±—ã–≤–∞—é—â–∏–π –Ω–∞ –≤–æ–∫–∑–∞–ª. –î–∏—Å–ø–µ—Ç—á–µ—Ä (Dispatcher) –¥–æ–ª–∂–µ–Ω:
1. –ü—Ä–∏–Ω—è—Ç—å –ø–æ–µ–∑–¥ (–ø–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ)
2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –Ω–∞ –∫–∞–∫–æ–π –ø—É—Ç—å –µ–≥–æ –Ω–∞–ø—Ä–∞–≤–∏—Ç—å (–∫–∞–∫–æ–π —Ö–µ–Ω–¥–ª–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç)
3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–µ–∑–¥ –ø–æ –Ω—É–∂–Ω–æ–º—É –ø—É—Ç–∏ (–ø–µ—Ä–µ–¥–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Ö–µ–Ω–¥–ª–µ—Ä—É)

–í —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Ä–º–∏–Ω–∞—Ö, **Dispatcher** ‚Äî —ç—Ç–æ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç aiogram, –∫–æ—Ç–æ—Ä—ã–π:
- –ü–æ–ª—É—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç Telegram API
- –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏—Ö –ø–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º (—Ö–µ–Ω–¥–ª–µ—Ä–∞–º) –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
- –£–ø—Ä–∞–≤–ª—è–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –∫–∞–∂–¥–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã Dispatcher

–î–∞–≤–∞–π—Ç–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –∫–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã Dispatcher, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –±—É–¥–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω–æ:

#### 1. `include_router(router)`
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Ä–æ—É—Ç–µ—Ä–æ–≤ –∫ –¥–∏—Å–ø–µ—Ç—á–µ—Ä—É. –†–æ—É—Ç–µ—Ä—ã ‚Äî —ç—Ç–æ –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ü–µ—Ö–∞ –Ω–∞ –∑–∞–≤–æ–¥–µ, –∫–∞–∂–¥—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–≤–æ—é —á–∞—Å—Ç—å —Ä–∞–±–æ—Ç—ã.

```python
from aiogram import Router

user_router = Router()
admin_router = Router()

# –ü–æ–¥–∫–ª—é—á–∞–µ–º —Ä–æ—É—Ç–µ—Ä—ã –∫ –¥–∏—Å–ø–µ—Ç—á–µ—Ä—É
dp.include_router(user_router)
dp.include_router(admin_router)
```

#### 2. `start_polling(bot)`
–ó–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —á–µ—Ä–µ–∑ long polling. –≠—Ç–æ –∫–∞–∫ –≤–∫–ª—é—á–∏—Ç—å –ø—Ä–∏–µ–º–Ω–∏–∫, —á—Ç–æ–±—ã –ª–æ–≤–∏—Ç—å —Ä–∞–¥–∏–æ–≤–æ–ª–Ω—ã.

```python
async def main():
    await dp.start_polling(bot)
```

#### 3. `feed_update(update)`
–ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—Ä—É—á–Ω—É—é –ø–µ—Ä–µ–¥–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ –¥–∏—Å–ø–µ—Ç—á–µ—Ä. –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –≤–µ–±—Ö—É–∫–∞–º–∏.

```python
# –°–æ–∑–¥–∞–µ–º –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
update = types.Update(message=types.Message(...))
await dp.feed_update(update)
```

#### 4. `workflow_data`, `context`, `storage`
–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º. –†–∞—Å—Å–º–æ—Ç—Ä–∏–º –∏—Ö –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –≥–ª–∞–≤–∞—Ö.

### –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

–î–∞–≤–∞–π—Ç–µ –ø—Ä–æ—Å–ª–µ–¥–∏–º –ø—É—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ —Ö–µ–Ω–¥–ª–µ—Ä–∞:

1. **–ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä
2. **–ü–∞—Ä—Å–∏–Ω–≥**: aiogram –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç JSON –≤ –æ–±—ä–µ–∫—Ç—ã Python
3. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: Dispatcher –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –ø–æ–¥—Ö–æ–¥–∏—Ç –ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–¥ —Ñ–∏–ª—å—Ç—Ä—ã —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤
4. **–í—ã–±–æ—Ä —Ö–µ–Ω–¥–ª–µ—Ä–∞**: –ù–∞—Ö–æ–¥–∏—Ç –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π —Ö–µ–Ω–¥–ª–µ—Ä
5. **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ**: –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ö–µ–Ω–¥–ª–µ—Ä —Å –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
6. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞, –ø–µ—Ä–µ–¥–∞–µ—Ç –µ–µ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫

```mermaid
graph TD
    A[–ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è] --> B[–ü–∞—Ä—Å–∏–Ω–≥]
    B --> C[–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è]
    C --> D[–í—ã–±–æ—Ä —Ö–µ–Ω–¥–ª–µ—Ä–∞]
    D --> E[–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ]
    E --> F[–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫]
```

---

## ü§ñ Bot - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫ Telegram API

### –ß—Ç–æ —Ç–∞–∫–æ–µ Bot?

**Bot** ‚Äî —ç—Ç–æ –≤–∞—à –ª–∏—á–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫, –∫–æ—Ç–æ—Ä—ã–π –≥–æ–≤–æ—Ä–∏—Ç –Ω–∞ —è–∑—ã–∫–µ Python –∏ –ø–æ–Ω–∏–º–∞–µ—Ç —è–∑—ã–∫ Telegram API. –ö–æ–≥–¥–∞ –≤—ã —Ö–æ—Ç–∏—Ç–µ —á—Ç–æ-—Ç–æ —Å–¥–µ–ª–∞—Ç—å –≤ Telegram (–æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ, –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∏ —Ç.–¥.), –≤—ã –æ–±—Ä–∞—â–∞–µ—Ç–µ—Å—å –∫ –æ–±—ä–µ–∫—Ç—É Bot.

–û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏ Bot:
- –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Telegram API
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Å –ø–æ–º–æ—â—å—é —Ç–æ–∫–µ–Ω–∞
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç Telegram
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –±–æ—Ç–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã Bot

–î–∞–≤–∞–π—Ç–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º —Å–∞–º—ã–µ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–µ—Ç–æ–¥—ã:

#### 1. –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
```python
# –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
await bot.send_message(chat_id=123, text="–ü—Ä–∏–≤–µ—Ç!")

# –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ
await bot.send_photo(chat_id=123, photo="photo.jpg", caption="–ö—Ä–∞—Å–∏–≤–æ–µ —Ñ–æ—Ç–æ")

# –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞
await bot.send_document(chat_id=123, document="document.pdf")
```

#### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
```python
# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ
me = await bot.get_me()
print(f"–ò–º—è –±–æ—Ç–∞: {me.first_name}")

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–∞—Ç–µ
chat = await bot.get_chat(chat_id=123)
print(f"–ù–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞: {chat.title}")

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
user = await bot.get_user(user_id=123456)
print(f"–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {user.full_name}")
```

#### 3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞–º–∏
```python
# –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
invite_link = await bot.create_chat_invite_link(chat_id=123)

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤
await bot.set_chat_permissions(chat_id=123, permissions=types.ChatPermissions(can_send_messages=True))

# –ö–∏–∫–Ω—É—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
await bot.ban_chat_member(chat_id=123, user_id=456)
```

#### 4. –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏
```python
# –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
file_info = await bot.get_file(file_id="ABC123")
file_path = file_info.file_path

# –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª
from aiogram import types
file = await types.FSInputFile(file_path)
await bot.send_document(chat_id=123, document=file)
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Bot

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Bot –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

```python
from aiogram.client.default import DefaultBotProperties
from aiogram.enums import ParseMode

bot = Bot(
    token="YOUR_TOKEN",
    default=DefaultBotProperties(
        parse_mode=ParseMode.HTML,  # –†–µ–∂–∏–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        link_preview_is_disabled=True,  # –û—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–µ–≤—å—é —Å—Å—ã–ª–æ–∫
        protect_content=True  # –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ—Å—ã–ª–∫–∏
    )
)
```

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `parse_mode` - —Ä–µ–∂–∏–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (HTML/Markdown)
- `link_preview_is_disabled` - –æ—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–µ–≤—å—é —Å—Å—ã–ª–æ–∫
- `protect_content` - –∑–∞—â–∏—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç –æ—Ç –ø–µ—Ä–µ—Å—ã–ª–∫–∏
- `disable_notification` - –æ—Ç–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

---

## üó∫Ô∏è Router - –æ—Ä–≥–∞–Ω–∏–∑—É–µ–º –∫–æ–¥ –ª–æ–≥–∏—á–Ω–æ

### –ß—Ç–æ —Ç–∞–∫–æ–µ Router?

**Router** ‚Äî —ç—Ç–æ –∫–∞–∫ —Ä–∞–∑–¥–µ–ª—ã –≤ –±–æ–ª—å—à–æ–π –∫–Ω–∏–≥–µ. –í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –ø–∏—Å–∞—Ç—å –≤—Å–µ —Ö–µ–Ω–¥–ª–µ—Ä—ã –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ, –º—ã —Ä–∞–∑–¥–µ–ª—è–µ–º –∏—Ö –ø–æ –ª–æ–≥–∏—á–µ—Å–∫–∏–º –±–ª–æ–∫–∞–º:
- –û–¥–∏–Ω —Ä–æ—É—Ç–µ—Ä –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∫–æ–º–∞–Ω–¥
- –î—Ä—É–≥–æ–π –¥–ª—è –∞–¥–º–∏–Ω—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π
- –¢—Ä–µ—Ç–∏–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–ª–∞—Ç–µ–∂–∞–º–∏
- –ò —Ç–∞–∫ –¥–∞–ª–µ–µ

–†–æ—É—Ç–µ—Ä—ã –ø–æ–º–æ–≥–∞—é—Ç:
- –û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –∫–æ–¥ –≤ –±–æ–ª—å—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö
- –ò–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –∏–º–µ–Ω
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å/—É–¥–∞–ª—è—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- –£–ø—Ä–æ—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Router

#### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–∞
```python
from aiogram import Router, F
from aiogram.filters import Command

user_router = Router()

@user_router.message(Command("start"))
async def cmd_start(message: types.Message):
    await message.answer("–ü—Ä–∏–≤–µ—Ç, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å!")

@user_router.message(F.text == "–ø–æ–º–æ—â—å")
async def cmd_help(message: types.Message):
    await message.answer("–ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?")
```

#### –®–∞–≥ 2: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –¥–∏—Å–ø–µ—Ç—á–µ—Ä—É
```python
dp = Dispatcher()
dp.include_router(user_router)
```

#### –®–∞–≥ 3: –í–ª–æ–∂–µ–Ω–Ω—ã–µ —Ä–æ—É—Ç–µ—Ä—ã
–†–æ—É—Ç–µ—Ä—ã –º–æ–∂–Ω–æ –≤–∫–ª–∞–¥—ã–≤–∞—Ç—å –¥—Ä—É–≥ –≤ –¥—Ä—É–≥–∞:

```python
# –ì–ª–∞–≤–Ω—ã–π —Ä–æ—É—Ç–µ—Ä
main_router = Router()

# –î–æ—á–µ—Ä–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä—ã
user_router = Router()
admin_router = Router()

# –í–∫–ª–∞–¥—ã–≤–∞–µ–º —Ä–æ—É—Ç–µ—Ä—ã
main_router.include_router(user_router)
main_router.include_router(admin_router)

# –ü–æ–¥–∫–ª—é—á–∞–µ–º –≥–ª–∞–≤–Ω—ã–π —Ä–æ—É—Ç–µ—Ä –∫ –¥–∏—Å–ø–µ—Ç—á–µ—Ä—É
dp.include_router(main_router)
```

### –í–ª–æ–∂–µ–Ω–Ω—ã–µ —Ä–æ—É—Ç–µ—Ä—ã

–í–ª–æ–∂–µ–Ω–Ω—ã–µ —Ä–æ—É—Ç–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –º–∞—Ç—Ä–µ—à–∫–∏ ‚Äî –≤–Ω–µ—à–Ω–∏–π —Ä–æ—É—Ç–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ. –≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è:
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏—è –æ–±—â–∏—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
- –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤

```python
# –°–æ–∑–¥–∞–µ–º —Ä–æ—É—Ç–µ—Ä—ã
main_router = Router()
user_router = Router()
admin_router = Router()

# –î–æ–±–∞–≤–ª—è–µ–º —Ö–µ–Ω–¥–ª–µ—Ä—ã –≤ –¥–æ—á–µ—Ä–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä—ã
@user_router.message(Command("profile"))
async def user_profile(message: types.Message):
    await message.answer("–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å")

@admin_router.message(Command("stats"))
async def admin_stats(message: types.Message):
    await message.answer("–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞")

# –í–∫–ª–∞–¥—ã–≤–∞–µ–º —Ä–æ—É—Ç–µ—Ä—ã
main_router.include_router(user_router)
main_router.include_router(admin_router)

# –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å middleware –¥–ª—è –≤—Å–µ–≥–æ main_router
@main_router.middleware()
async def main_middleware(handler, event, data):
    print("–û–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ main_router")
    return await handler(event, data)
```

---

## ‚ö° –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –≤ aiogram

### –ü–æ—á–µ–º—É –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–∞?

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –≤—ã –æ—Ñ–∏—Ü–∏–∞–Ω—Ç –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ. –ï—Å–ª–∏ –≤—ã –ø–æ–¥—Ö–æ–¥–∏—Ç–µ –∫ —Å—Ç–æ–ª–∏–∫—É, –ø—Ä–∏–Ω–∏–º–∞–µ—Ç–µ –∑–∞–∫–∞–∑, –æ—Ç–Ω–æ—Å–∏—Ç–µ –µ–≥–æ –Ω–∞ –∫—É—Ö–Ω—é, –∂–¥–µ—Ç–µ, –ø–æ–∫–∞ –ø—Ä–∏–≥–æ—Ç–æ–≤—è—Ç, –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º –∏–¥–µ—Ç–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Å—Ç–æ–ª–∏–∫—É ‚Äî —ç—Ç–æ **—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π** –ø–æ–¥—Ö–æ–¥. –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ, –ø—Ä–∞–≤–¥–∞?

**–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π** –ø–æ–¥—Ö–æ–¥: –≤—ã –ø—Ä–∏–Ω–∏–º–∞–µ—Ç–µ –∑–∞–∫–∞–∑ —É –ø–µ—Ä–≤–æ–≥–æ —Å—Ç–æ–ª–∏–∫–∞, –æ—Ç–Ω–æ—Å–∏—Ç–µ –Ω–∞ –∫—É—Ö–Ω—é, –∏ –ø–æ–∫–∞ –≥–æ—Ç–æ–≤–∏—Ç—Å—è ‚Äî –∏–¥–µ—Ç–µ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–∫–∞–∑ —É –≤—Ç–æ—Ä–æ–≥–æ —Å—Ç–æ–ª–∏–∫–∞. –¢–∞–∫ –≤—ã –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç–µ –±–æ–ª—å—à–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∑–∞ —Ç–æ –∂–µ –≤—Ä–µ–º—è.

–í –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ç–æ –∂–µ —Å–∞–º–æ–µ:
- **–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥**: –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–¥–Ω—É –æ–ø–µ—Ä–∞—Ü–∏—é –∑–∞ —Ä–∞–∑, –±–ª–æ–∫–∏—Ä—É—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥—Ä—É–≥–∏—Ö
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥**: –º–æ–∂–µ—Ç –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–¥–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –Ω–∞ –¥—Ä—É–≥—É—é

### –û—Å–Ω–æ–≤—ã async/await

#### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:
1. **`async def`** ‚Äî –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
2. **`await`** ‚Äî –æ–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
3. **Event Loop** ‚Äî —Ü–∏–∫–ª —Å–æ–±—ã—Ç–∏–π, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á

#### –ü—Ä–∏–º–µ—Ä:
```python
import asyncio
import time

# –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
def sync_function():
    print("–ù–∞—á–∞–ª–æ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏")
    time.sleep(2)  # –ë–ª–æ–∫–∏—Ä—É–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞ 2 —Å–µ–∫—É–Ω–¥—ã
    print("–ö–æ–Ω–µ—Ü —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏")

# –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
async def async_function():
    print("–ù–∞—á–∞–ª–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏")
    await asyncio.sleep(2)  # –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–µ–µ –æ–∂–∏–¥–∞–Ω–∏–µ
    print("–ö–æ–Ω–µ—Ü –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏")

async def main():
    print("–ó–∞–ø—É—Å–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:")
    start = time.time()
    sync_function()
    sync_function()
    print(f"–ó–∞—Ç—Ä–∞—á–µ–Ω–æ –≤—Ä–µ–º–µ–Ω–∏: {time.time() - start:.2f} —Å–µ–∫—É–Ω–¥")
    
    print("\n–ó–∞–ø—É—Å–∫ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:")
    start = time.time()
    await asyncio.gather(
        async_function(),
        async_function()
    )
    print(f"–ó–∞—Ç—Ä–∞—á–µ–Ω–æ –≤—Ä–µ–º–µ–Ω–∏: {time.time() - start:.2f} —Å–µ–∫—É–Ω–¥")

asyncio.run(main())
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
```
–ó–∞–ø—É—Å–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:
–ù–∞—á–∞–ª–æ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
–ö–æ–Ω–µ—Ü —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
–ù–∞—á–∞–ª–æ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
–ö–æ–Ω–µ—Ü —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
–ó–∞—Ç—Ä–∞—á–µ–Ω–æ –≤—Ä–µ–º–µ–Ω–∏: 4.00 —Å–µ–∫—É–Ω–¥

–ó–∞–ø—É—Å–∫ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:
–ù–∞—á–∞–ª–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
–ù–∞—á–∞–ª–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
–ö–æ–Ω–µ—Ü –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
–ö–æ–Ω–µ—Ü –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
–ó–∞—Ç—Ä–∞—á–µ–Ω–æ –≤—Ä–µ–º–µ–Ω–∏: 2.00 —Å–µ–∫—É–Ω–¥
```

### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –≤ aiogram

–í—Å–µ —Ö–µ–Ω–¥–ª–µ—Ä—ã –≤ aiogram –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏:

```python
# –ü—Ä–∞–≤–∏–ª—å–Ω–æ
@dp.message(Command("start"))
async def cmd_start(message: types.Message):
    await message.answer("–ü—Ä–∏–≤–µ—Ç!")

# –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ - –≤—ã–∑–æ–≤–µ—Ç –æ—à–∏–±–∫—É!
@dp.message(Command("help"))
def cmd_help(message: types.Message):
    message.answer("–ü–æ–º–æ—â—å")  # –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç await
```

**–ü–æ—á–µ–º—É –≤—Å–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º?**
1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –±–æ—Ç –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç—ã—Å—è—á–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
2. **–ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**: –æ–∂–∏–¥–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –æ—Ç Telegram –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –±–æ—Ç–∞
3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –ª–µ–≥–∫–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏ (–±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, HTTP-–∫–ª–∏–µ–Ω—Ç—ã)

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –ü–æ—á–µ–º—É –≤–∞–∂–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞?

–ö–æ–≥–¥–∞ –≤—ã —Å–æ–∑–¥–∞–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ–≥–æ –±–æ—Ç–∞ —Å 10 —Ö–µ–Ω–¥–ª–µ—Ä–∞–º–∏, –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å –≤—Å–µ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ. –ù–æ –∫–æ–≥–¥–∞ –ø—Ä–æ–µ–∫—Ç —Ä–∞—Å—Ç–µ—Ç –¥–æ —Å–æ—Ç–µ–Ω —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤, –ø–æ—è–≤–ª—è–µ—Ç—Å—è:
- –ü—É—Ç–∞–Ω–∏—Ü–∞ –≤ –∫–æ–¥–µ
- –°–ª–æ–∂–Ω–æ—Å—Ç—å –≤ –ø–æ–∏—Å–∫–µ –Ω—É–∂–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
- –ü—Ä–æ–±–ª–µ–º—ã —Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- –¢—Ä—É–¥–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

–•–æ—Ä–æ—à–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ —Ä–µ—à–∞–µ—Ç —ç—Ç–∏ –ø—Ä–æ–±–ª–µ–º—ã!

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
my_bot/
‚îú‚îÄ‚îÄ venv/                    # –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ bot.py                   # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ config.py                # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ requirements.txt         # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ handlers/                # –•–µ–Ω–¥–ª–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ user_handlers.py     # –•–µ–Ω–¥–ª–µ—Ä—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ admin_handlers.py    # –•–µ–Ω–¥–ª–µ—Ä—ã –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ payment_handlers.py  # –•–µ–Ω–¥–ª–µ—Ä—ã –¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π
‚îú‚îÄ‚îÄ keyboards/               # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ user_keyboards.py    # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îî‚îÄ‚îÄ admin_keyboards.py   # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
‚îú‚îÄ‚îÄ services/                # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ user_service.py      # –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ payment_service.py   # –õ–æ–≥–∏–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π
‚îú‚îÄ‚îÄ utils/                   # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ decorators.py        # –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã
‚îÇ   ‚îî‚îÄ‚îÄ helpers.py           # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îî‚îÄ‚îÄ middlewares/             # –ú–∏–¥–ª–≤–∞—Ä–∏
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îî‚îÄ‚îÄ auth_middleware.py   # –ú–∏–¥–ª–≤–∞—Ä—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
```

### –ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

#### 1. –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (bot.py)
```python
import asyncio
import logging
from aiogram import Bot, Dispatcher
from config import BOT_TOKEN

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ä–æ—É—Ç–µ—Ä—ã
from handlers.user_handlers import user_router
from handlers.admin_handlers import admin_router
from handlers.payment_handlers import payment_router

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(level=logging.INFO)

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞ –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞
bot = Bot(token=BOT_TOKEN)
dp = Dispatcher()

# –ü–æ–¥–∫–ª—é—á–∞–µ–º —Ä–æ—É—Ç–µ—Ä—ã
dp.include_router(user_router)
dp.include_router(admin_router)
dp.include_router(payment_router)

async def main():
    await dp.start_polling(bot)

if __name__ == "__main__":
    asyncio.run(main())
```

#### 2. –•–µ–Ω–¥–ª–µ—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (handlers/user_handlers.py)
```python
from aiogram import Router, F
from aiogram.filters import Command
from aiogram.types import Message

user_router = Router()

@user_router.message(Command("start"))
async def cmd_start(message: Message):
    await message.answer("–ü—Ä–∏–≤–µ—Ç! –Ø —Ç–≤–æ–π –±–æ—Ç!")

@user_router.message(F.text == "–ø–æ–º–æ—â—å")
async def cmd_help(message: Message):
    await message.answer("–ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?")
```

#### 3. –•–µ–Ω–¥–ª–µ—Ä—ã –∞–¥–º–∏–Ω–æ–≤ (handlers/admin_handlers.py)
```python
from aiogram import Router, F
from aiogram.filters import Command, AdminFilter
from aiogram.types import Message

admin_router = Router()

@admin_router.message(Command("stats"), AdminFilter(is_admin=True))
async def cmd_stats(message: Message):
    await message.answer("–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞...")
```

#### 4. –°–µ—Ä–≤–∏—Å—ã (services/user_service.py)
```python
class UserService:
    def __init__(self, db_connection):
        self.db = db_connection
    
    async def get_user(self, user_id: int):
        # –õ–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î
        pass
    
    async def create_user(self, user_data):
        # –õ–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        pass
```

---

## üß© Dependency Injection (DI)

### –ß—Ç–æ —Ç–∞–∫–æ–µ DI?

**Dependency Injection (DI)** ‚Äî —ç—Ç–æ –ø–∞—Ç—Ç–µ—Ä–Ω –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ–±—ä–µ–∫—Ç–∞ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –∏–∑–≤–Ω–µ, –∞ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ —Å–∞–º–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞.

–ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏: –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Å–∞, –º—ã "–≤–Ω–µ–¥—Ä—è–µ–º" –∏—Ö —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∏–ª–∏ –º–µ—Ç–æ–¥—ã.

**–ü—Ä–∏–º–µ—Ä –±–µ–∑ DI:**
```python
class UserService:
    def __init__(self):
        self.db = DatabaseConnection()  # –ñ–µ—Å—Ç–∫–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
    
    def get_user(self, user_id):
        return self.db.query("SELECT * FROM users WHERE id = ?", user_id)
```

**–ü—Ä–∏–º–µ—Ä —Å DI:**
```python
class UserService:
    def __init__(self, db_connection):  # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∏–∑–≤–Ω–µ
        self.db = db_connection
    
    def get_user(self, user_id):
        return self.db.query("SELECT * FROM users WHERE id = ?", user_id)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ DI:**
- –ì–∏–±–∫–æ—Å—Ç—å: –ª–µ–≥–∫–æ –∑–∞–º–µ–Ω–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å: –º–æ–∂–Ω–æ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å mock-–æ–±—ä–µ–∫—Ç—ã –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
- –°–ª–∞–±–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å: –∫–ª–∞—Å—Å—ã –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π

### DI –≤ aiogram

Aiogram 3.x –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É DI —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ —Ö–µ–Ω–¥–ª–µ—Ä—ã.

#### –û—Å–Ω–æ–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:

1. **–ß–µ—Ä–µ–∑ middleware**
```python
from aiogram import Bot, Dispatcher
from services.user_service import UserService

async def user_service_middleware(handler, event, data):
    # –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –ø–æ–ª—É—á–∞–µ–º —Å–µ—Ä–≤–∏—Å
    user_service = UserService(db_connection=data["db"])
    # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
    data["user_service"] = user_service
    return await handler(event, data)

# –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º middleware
dp.update.middleware(user_service_middleware)

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ö–µ–Ω–¥–ª–µ—Ä–µ
@dp.message(Command("profile"))
async def cmd_profile(message: Message, user_service: UserService):
    user = await user_service.get_user(message.from_user.id)
    await message.answer(f"–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å: {user}")
```

2. **–ß–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞**
```python
from aiogram import Bot, Dispatcher
from services.user_service import UserService

# –°–æ–∑–¥–∞–µ–º —Å–µ—Ä–≤–∏—Å
user_service = UserService(db_connection=db)

# –î–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
dp["user_service"] = user_service

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ö–µ–Ω–¥–ª–µ—Ä–µ
@dp.message(Command("profile"))
async def cmd_profile(message: Message):
    user_service = dp["user_service"]
    user = await user_service.get_user(message.from_user.id)
    await message.answer(f"–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å: {user}")
```

3. **–ß–µ—Ä–µ–∑ —Ñ–∞–±—Ä–∏–∫—É (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–±)**
```python
from aiogram import Bot, Dispatcher
from aiogram.fsm.context import FSMContext
from aiogram.fsm.storage.memory import MemoryStorage
from services.user_service import UserService

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
storage = MemoryStorage()

# –§–∞–±—Ä–∏–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
async def user_service_factory(
    bot: Bot,
    dispatcher: Dispatcher,
    event: types.Update,
    **kwargs
) -> UserService:
    return UserService(db_connection=dispatcher["db"])

# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ñ–∞–±—Ä–∏–∫–∏
dp.update.register(user_service_factory, UserService)

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ö–µ–Ω–¥–ª–µ—Ä–µ
@dp.message(Command("profile"))
async def cmd_profile(message: Message, user_service: UserService):
    user = await user_service.get_user(message.from_user.id)
    await message.answer(f"–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å: {user}")
```

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä

–î–∞–≤–∞–π—Ç–µ —Å–æ–∑–¥–∞–¥–∏–º –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Å DI:

#### 1. –°–µ—Ä–≤–∏—Å (services/user_service.py)
```python
class UserService:
    def __init__(self, db_connection):
        self.db = db_connection
    
    async def get_user(self, user_id: int):
        # –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞ –∫ –ë–î
        return {"id": user_id, "name": "John Doe"}
    
    async def create_user(self, user_data: dict):
        # –ò–º–∏—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        return {"id": 123, **user_data}
```

#### 2. –ú–∏–¥–ª–≤–∞—Ä—å (middlewares/di_middleware.py)
```python
from services.user_service import UserService

async def di_middleware(handler, event, data):
    # –°–æ–∑–¥–∞–µ–º —Å–µ—Ä–≤–∏—Å—ã
    user_service = UserService(db_connection=data["db"])
    
    # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
    data["user_service"] = user_service
    
    return await handler(event, data)
```

#### 3. –•–µ–Ω–¥–ª–µ—Ä (handlers/user_handlers.py)
```python
from aiogram import Router, F
from aiogram.filters import Command
from aiogram.types import Message

user_router = Router()

@user_router.message(Command("profile"))
async def cmd_profile(message: Message, user_service: UserService):
    user = await user_service.get_user(message.from_user.id)
    await message.answer(f"–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å: {user}")

@user_router.message(Command("register"))
async def cmd_register(message: Message, user_service: UserService):
    user_data = {
        "name": message.from_user.full_name,
        "username": message.from_user.username
    }
    user = await user_service.create_user(user_data)
    await message.answer(f"–í—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã: {user}")
```

#### 4. –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (bot.py)
```python
import asyncio
import logging
from aiogram import Bot, Dispatcher
from middlewares.di_middleware import di_middleware
from handlers.user_handlers import user_router

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(level=logging.INFO)

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞ –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞
bot = Bot(token="YOUR_TOKEN")
dp = Dispatcher()

# –î–æ–±–∞–≤–ª—è–µ–º "–±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö" –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
dp["db"] = {}  # –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –∑–¥–µ—Å—å –±—É–¥–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –ë–î

# –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º middleware
dp.update.middleware(di_middleware)

# –ü–æ–¥–∫–ª—é—á–∞–µ–º —Ä–æ—É—Ç–µ—Ä—ã
dp.include_router(user_router)

async def main():
    await dp.start_polling(bot)

if __name__ == "__main__":
    asyncio.run(main())
```

> üí° **–î–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è DI** —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª [06-dip.md](06-dip.md) –∏–∑ –Ω–∞—à–µ–≥–æ –∫—É—Ä—Å–∞ –ø–æ SOLID –ø—Ä–∏–Ω—Ü–∏–ø–∞–º. –¢–∞–º –≤—ã –Ω–∞–π–¥–µ—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ Dependency Inversion Principle –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã.

---

## üìù –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∫–æ–¥–∞

–î–∞–≤–∞–π—Ç–µ —Å–æ–±–µ—Ä–µ–º –≤—Å–µ –≤–º–µ—Å—Ç–µ –≤ –æ–¥–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ:

```python
import asyncio
import logging
from aiogram import Bot, Dispatcher, Router, F, types
from aiogram.filters import Command
from aiogram.fsm.context import FSMContext
from aiogram.fsm.storage.memory import MemoryStorage

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(level=logging.INFO)

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞ –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞
bot = Bot(token="YOUR_TOKEN")
storage = MemoryStorage()
dp = Dispatcher(storage=storage)

# –°–æ–∑–¥–∞–µ–º —Ä–æ—É—Ç–µ—Ä—ã
user_router = Router()
admin_router = Router()

# –°–µ—Ä–≤–∏—Å (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –±—É–¥–µ—Ç –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ)
class UserService:
    def __init__(self, db):
        self.db = db
    
    async def get_user(self, user_id):
        return self.db.get(user_id, {"id": user_id, "name": "Unknown"})
    
    async def save_user(self, user_id, user_data):
        self.db[user_id] = user_data
        return user_data

# Middleware –¥–ª—è DI
async def di_middleware(handler, event, data):
    user_service = UserService(db=data["db"])
    data["user_service"] = user_service
    return await handler(event, data)

# –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º middleware
dp.update.middleware(di_middleware)

# –•–µ–Ω–¥–ª–µ—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
@user_router.message(Command("start"))
async def cmd_start(message: types.Message, user_service: UserService):
    user = await user_service.get_user(message.from_user.id)
    await message.answer(f"–ü—Ä–∏–≤–µ—Ç, {user['name']}!")

@user_router.message(Command("profile"))
async def cmd_profile(message: types.Message, user_service: UserService):
    user = await user_service.get_user(message.from_user.id)
    await message.answer(f"–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å: {user}")

@user_router.message(Command("setname"))
async def cmd_setname(message: types.Message, user_service: UserService, state: FSMContext):
    await message.answer("–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –Ω–æ–≤–æ–µ –∏–º—è:")
    await state.set_state("waiting_for_name")

@user_router.message(F.text, state="waiting_for_name")
async def process_name(message: types.Message, user_service: UserService, state: FSMContext):
    user_data = {"id": message.from_user.id, "name": message.text}
    await user_service.save_user(message.from_user.id, user_data)
    await message.answer(f"–ò–º—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ: {message.text}")
    await state.clear()

# –•–µ–Ω–¥–ª–µ—Ä—ã –∞–¥–º–∏–Ω–æ–≤
@admin_router.message(Command("stats"))
async def cmd_stats(message: types.Message, user_service: UserService):
    users_count = len(user_service.db)
    await message.answer(f"–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {users_count}")

# –ü–æ–¥–∫–ª—é—á–∞–µ–º —Ä–æ—É—Ç–µ—Ä—ã
dp.include_router(user_router)
dp.include_router(admin_router)

# –î–æ–±–∞–≤–ª—è–µ–º "–±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö" –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
dp["db"] = {}

async def main():
    await dp.start_polling(bot)

if __name__ == "__main__":
    asyncio.run(main())
```

---

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ú—ã –∏–∑—É—á–∏–ª–∏ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ aiogram 3.x, –∫–æ—Ç–æ—Ä—ã–µ —è–≤–ª—è—é—Ç—Å—è –æ—Å–Ω–æ–≤–æ–π –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ª—é–±—ã—Ö –±–æ—Ç–æ–≤. –î–∞–≤–∞–π—Ç–µ –ø–æ–¥–≤–µ–¥–µ–º –∏—Ç–æ–≥–∏:

### –ß—Ç–æ –º—ã —É–∑–Ω–∞–ª–∏:
1. **Dispatcher** ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, —É–ø—Ä–∞–≤–ª—è—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
2. **Bot** ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Telegram API
3. **Router** ‚Äî –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞ –≤ –±–æ–ª—å—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö
4. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å** ‚Äî –∫–ª—é—á –∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –±–æ—Ç–æ–≤
5. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞** ‚Äî –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –∫–æ–¥
6. **Dependency Injection** ‚Äî –∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å –∫–æ–¥ –≥–∏–±–∫–∏–º –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã–º

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:
- **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**: –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–Ω–∏–º–∞—Ç—å—Å—è —Å–≤–æ–∏–º –¥–µ–ª–æ–º
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å**: –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–º–∏
- **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å**: –∫–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –±–ª–æ–∫–∏
- **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ DI –¥–ª—è –ª–µ–≥–∫–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ß—Ç–æ –¥–∞–ª—å—à–µ?

–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –≤—ã –ø–æ–Ω–∏–º–∞–µ—Ç–µ –æ—Å–Ω–æ–≤—ã, –≤—ã –≥–æ—Ç–æ–≤—ã –∫ –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–º —Ç–µ–º–∞–º:
- **–§–∏–ª—å—Ç—Ä—ã –∏ –º–∏–¥–ª–≤–∞—Ä–∏** (–≥–ª–∞–≤–∞ 07-–§–∏–ª—å—Ç—Ä—ã-—Å–æ–±—ã—Ç–∏–π –∏ 08-–ú–∏–¥–ª–≤–∞—Ä–∏)
- **–ö–æ–Ω–µ—á–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç—ã (FSM)** (–≥–ª–∞–≤–∞ 10-–ö–æ–Ω–µ—á–Ω—ã–µ-–∞–≤—Ç–æ–º–∞—Ç—ã-FSM)
- **Webhook –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ** (–≥–ª–∞–≤–∞ 14-Webhook-–∏-—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ)

### –°–æ–≤–µ—Ç—ã –¥–ª—è –ø—Ä–∞–∫—Ç–∏–∫–∏:
1. **–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç** —Å —Ö–æ—Ä–æ—à–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–æ—É—Ç–µ—Ä—ã** –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
3. **–ü—Ä–∏–º–µ–Ω–∏—Ç–µ DI** –¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
4. **–ü–∏—à–∏—Ç–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥** –≤–æ –≤—Å–µ—Ö —Ö–µ–Ω–¥–ª–µ—Ä–∞—Ö
5. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ** –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ—Ç–¥–µ–ª—å–Ω–æ

### –ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã:
- [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è aiogram](https://docs.aiogram.dev/)
- [Python asyncio –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://docs.python.org/3/library/asyncio.html)
- [–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ Dependency Injection](06-dip.md)

---

> üí° **–í–∞–∂–Ω–æ:** –ü–æ–Ω–∏–º–∞–Ω–∏–µ —ç—Ç–∏—Ö –æ—Å–Ω–æ–≤ ‚Äî 80% —É—Å–ø–µ—Ö–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –±–æ—Ç–æ–≤ –Ω–∞ aiogram. –ù–µ —Ç–æ—Ä–æ–ø–∏—Ç–µ—Å—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ —Å–ª–æ–∂–Ω—ã–º —Ç–µ–º–∞–º, –ø–æ–∫–∞ –Ω–µ —É—Å–≤–æ–∏—Ç–µ —ç—Ç–∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏.

> ‚ö†Ô∏è **–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ:** –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ —Ö–µ–Ω–¥–ª–µ—Ä–∞—Ö –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ä–≥–∞–Ω–∏–∑—É–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ —Å —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞.

–¢–µ–ø–µ—Ä—å –≤—ã –≥–æ—Ç–æ–≤—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã—Ö, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã—Ö –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã—Ö –±–æ—Ç–æ–≤! –£–¥–∞—á–∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ! üöÄ‚ú®